<html>

<head>
    <title>Simple Search Bar</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="search-form">
        <input type="text" id="search-input" placeholder="search for album">
        <button type="submit" id="search-button"><img src="search-icon.png" height=30px width=30px id="search-icon"></button>
    </form>

    <div id="search results"></div>

    <div id="edit album"></div>


    <script>

        // Get the elements from the document
        var searchForm = document.getElementById("search-form");
        var searchInput = document.getElementById("search-input");
        var searchButton = document.getElementById("search-button");


        // Add an event listener to the form submission
        searchForm.addEventListener("submit", async function(event) {

           event.preventDefault();

          // Get the value of the input
          const query = encodeURI(searchInput.value);
          // Check if the input is not empty
          if (query) {

          document.getElementById("edit album").innerHTML = "";



          fetch("http://localhost:3000/api/getAccessToken").then(response => response.text()).then(function(token){fetch("https://api.spotify.com/v1/search?q="+query+"&type=album&limit=5",
              {method: 'GET', headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + token
              }}).then(response => response.json()).then(function(json){


            const div = document.getElementById("search results");

            div.innerHTML = "";

            const ul = document.createElement('ul');

            ul.setAttribute("id", "searchResults");

            for(var i = 0; i < 5; i++){

              var li = document.createElement('li');
              li.setAttribute("class", "search-result")

              //li.setAttribute("onclick", "addAlbum('"+jsonResponse.results.albummatches.album[i].name+"', '"+jsonResponse.results.albummatches.album[i].artist+"')");

              const albumTitle = document.createElement("p");
              albumTitle.innerHTML = json.albums.items[i].name;
              albumTitle.setAttribute("class", "albumTitle");

              li.appendChild(albumTitle);

              const albumArtist = document.createElement("p");
              albumArtist.innerHTML=json.albums.items[i].artists[0].name;
              albumArtist.setAttribute("class", "albumArtist");

              li.appendChild(albumArtist);

              const image = document.createElement("img");

            image.setAttribute("onerror", "this.src='loading.gif';");
            image.setAttribute("src", json.albums.items[i].images[1].url);
            image.setAttribute("width", "50px");
            image.setAttribute("height", "50px");

            li.appendChild(image);

            li.appendChild(albumTitle);
            li.appendChild(albumArtist);

            ul.appendChild(li);

            }

            div.appendChild(ul);
            })});
          } else {
            // Display a message if the input is empty
            alert("Please enter a query");
          }
          });

/*
        function addAlbum(albumName, albumArtist){
            document.getElementById("search results").innerHTML = "";

            const jsonResponse = JSON.parse(xmlHttp.responseText);

            const div = document.getElementById("edit album");

            div.appendChild(image);

            const nameInput = document.createElement("input");

            nameInput.setAttribute("type", "text");
            nameInput.setAttribute("value", albumName);
            div.appendChild(nameInput);

            const artistInput = document.createElement("input");

            artistInput.setAttribute("type", "text");
            artistInput.setAttribute("value", albumArtist);
            div.appendChild(artistInput);


            alert(jsonResponse.album.releasedate);

            const releaseDateInput = document.createElement("input");

            releaseDateInput.setAttribute("type", "date");
            releaseDateInput.setAttribute("value", "");
            div.appendChild(releaseDateInput);
        }
        */
    </script>
</body>
</html>
