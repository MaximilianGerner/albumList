<html>

<head>
    <title>Simple Search Bar</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <form id="search-form">
        <input type="text" id="search-input" placeholder="search for album">
        <button type="submit" id="search-button"><img height=30px width=30px id="search-icon" src="search-icon.png"></button>
    </form>

    <div id="search results"></div>

    <div id="edit album"></div>

    <script>
        // Get the elements from the document
        var searchForm = document.getElementById("search-form");
        var searchInput = document.getElementById("search-input");
        var searchButton = document.getElementById("search-button");


        // Add an event listener to the form submission
        searchForm.addEventListener("submit", function(event) {
//Test


            // First it should search in the database itself and only afterwards in last.fm



            // Prevent the default behavior of the form
            event.preventDefault();
            // Get the value of the input
            const query = encodeURI(searchInput.value);
            // Check if the input is not empty
            if (query) {
                document.getElementById("edit album").innerHTML = "";

                var xmlHttp = new XMLHttpRequest();
                xmlHttp.open( "GET", "https://musicbrainz.org/ws/2/release-group/?query=release:"+query+"%20AND%20primarytype:album%20OR%20primarytype:EP&limit=5&fmt=json", false ); // false for synchronous request
                xmlHttp.send( null );

                const jsonResponse = JSON.parse(xmlHttp.responseText);

                const div = document.getElementById("search results");

                div.innerHTML = "";

                const ul = document.createElement('ul');

                ul.setAttribute("id", "searchResults");

                for(var i = 0; i < 5; i++){

                    var li = document.createElement('li');

                    li.setAttribute("class", "search-result")

                    //li.setAttribute("onclick", "addAlbum('"+jsonResponse.results.albummatches.album[i].name+"', '"+jsonResponse.results.albummatches.album[i].artist+"')");

                    const albumTitle = document.createElement("p");
                    albumTitle.innerHTML = jsonResponse["release-groups"][i].title;
                    albumTitle.setAttribute("class", "albumTitle");

                    li.appendChild(albumTitle);

                    const albumArtist = document.createElement("p");
                    albumArtist.innerHTML=jsonResponse["release-groups"][i]["artist-credit"][0].name;
                    albumArtist.setAttribute("class", "albumArtist");

                    li.appendChild(albumArtist);

                    //const album_text = document.createTextNode(jsonResponse["release-groups"][i].title + " by " + jsonResponse["release-groups"][i]["artist-credit"][0].name);

                    const image = document.createElement("img");

                    
                    var xmlHttp = new XMLHttpRequest();
                    xmlHttp.open("GET", "coverartarchive.org/release/" + jsonResponse.["release-groups"][i].releases[0].id);
                        

                    //image.setAttribute("src", jsonResponse.results.albummatches.album[i].image[1]['#text']);
                    image.setAttribute("onerror", "this.src='loading.gif';");

                    li.appendChild(image);

                    //li.appendChild(album_text);

                    ul.appendChild(li);
                }

                div.appendChild(ul);
            } else {
                // Display a message if the input is empty
                alert("Please enter a query");
            }
        });


        function addAlbum(albumName, albumArtist){
            document.getElementById("search results").innerHTML = "";

            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", "https://ws.audioscrobbler.com/2.0/?method=album.getinfo&api_key=0bec9e54af5064471cae94471edf6f06&artist="+albumArtist+"&album="+albumName+"&format=json", false );
            xmlHttp.send( null );

            const jsonResponse = JSON.parse(xmlHttp.responseText);

            const div = document.getElementById("edit album");

            const image = document.createElement("img");
            image.setAttribute("src", jsonResponse.album.image[2]['#text']);
            //image.setAttribute("onerror", "this.src='/home/max/projects/albumList/playground/loading.gif'");

            div.appendChild(image);

            const nameInput = document.createElement("input");

            nameInput.setAttribute("type", "text");
            nameInput.setAttribute("value", albumName);
            div.appendChild(nameInput);

            const artistInput = document.createElement("input");

            artistInput.setAttribute("type", "text");
            artistInput.setAttribute("value", albumArtist);
            div.appendChild(artistInput);


            alert(jsonResponse.album.releasedate);

            const releaseDateInput = document.createElement("input");

            releaseDateInput.setAttribute("type", "date");
            releaseDateInput.setAttribute("value", "");
            div.appendChild(releaseDateInput);
        }
    </script>
</body>
</html>
